{{#if this.isCustomHomepage}} 
  <section class="resources snipcss-aQjeH">
    <h2>Subscribers Around the World</h2>
    <p>Explore where our community members are located!</p>
    
    <!-- Map Section -->
    <div id="map"></div>

    <!-- Include Leaflet JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    
    <style>
      #map {
        height: 500px;
        width: 100%;
        margin: 20px 0;
      }
      
      .gold-marker {
        background-color: gold;
        border: 2px solid black;
        border-radius: 50%;
        width: 15px;
        height: 15px;
        display: inline-block;
      }
    </style>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize the map
        var map = L.map('map').setView([20.5937, 78.9629], 2); // Center on India by default

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Custom marker icon
        var goldMarker = L.divIcon({
          className: 'gold-marker',
          iconSize: [15, 15]
        });

        // Fetch user data dynamically
        // Assuming the Discourse API provides user data with the 'location' field

        function addUserToMap(username, location) {
          // Placeholder: Coordinates for some common countries (manual fallback)
          var locationCoordinates = {
            "India": [20.5937, 78.9629],
            "USA": [37.0902, -95.7129],
            "UK": [51.5074, -0.1278],
            "Germany": [51.1657, 10.4515],
            "Australia": [-25.2744, 133.7751],
            "France": [46.6034, 1.8883],
            // Add more default country coordinates here
          };

          // Use default coordinates for location if found
          var coordinates = locationCoordinates[location];

          if (coordinates) {
            // Add the marker on the map
            L.marker(coordinates, {icon: goldMarker}).addTo(map)
              .bindPopup("<b>" + username + " from " + location + "</b>");
          }
        }

        // Fetch users from Discourse API or backend (This is just a template call)
        api.getJSON('/users.json').then(function (data) {
          // Assuming data contains user details with a location field
          var users = data.users;

          users.forEach(function (user) {
            if (user.location) {
              addUserToMap(user.username, user.location);
            }
          });
        });

      });
    </script>
  </section>
{{/if}}
